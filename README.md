# Habit Tracker API
Habit Tracker API — это RESTful API для управления привычками пользователей. Он позволяет создавать, читать, обновлять и удалять привычки, а также получать публичные и приятные привычки. 
API разработан с использованием Django и Django REST Framework.
## Содержание

- [Установка](#установка)
- [Использование](#использование)
- [Примеры запросов в Postman](#примеры-запросов-в-postman)

## Установка

1. Клонируйте репозиторий:

```bash
   git clone https://github.com/DanielNegusto/Habit_tracker.git
   cd ваш-репозиторий
```

2. Создайте и активируйте виртуальное окружение:

```bash
python -m venv venv
source venv/bin/activate  # для Linux/Mac
venv\Scripts\activate  # для Windows
```

3. Установите зависимости:

```bash
pip install -r req.txt
```

4. Примените миграции:

```bash
python manage.py migrate
```

5. Запустите сервер:
```bash
python manage.py runserver
```
Теперь ваше приложение доступно по адресу http://localhost:8000/.

# Использование:

## Аутентификация
Для получения токена вам нужно отправить POST запрос на следующие эндпоинты:
1. Получение токена:

- URL: /api/token/
- Метод: POST
- Тело запроса (JSON):
```bash
{
    "username": "ваш_логин",
    "password": "ваш_пароль"
}
```
2. Обновление токена:

- URL: /api/token/refresh/
- Метод: POST
- Тело запроса (JSON):
```bash
{
    "refresh": "ваш_refresh_токен"
}
```
3. После получения токена, при отправке запросов добавьте заголовок:
```bash
Authorization: Bearer <token>
```

## Эндпоинты

### Привычки
Получить список привычек: GET /api/habits/

Возвращает список привычек текущего пользователя (неприятные привычки).
Создать привычку: POST /api/habits/

Создает новую привычку для текущего пользователя.
Получить публичные привычки: GET /api/habits/public/

Возвращает список публичных привычек (доступно для всех пользователей).
Получить приятные привычки: GET /api/habits/pleasant/

Возвращает список приятных привычек текущего пользователя (доступно только для авторизованных пользователей).

## Данные файла .env
Заполните файл ".env_example" своими данными и переименуйте его в '.env'

## Celery

В этом проекте реализована функциональность для отправки уведомлений пользователям и управления  с использованием Celery и telegram

## Установка и настройка

1. Убедитесь, что у вас установлен Celery и необходимые зависимости.
2. Настройте SMTP сервер в файле конфигурации вашего проекта для отправки почты.
3. Запустите Celery worker и Celery Beat в отдельных терминалах:

   ```bash
   # Запуск worker
   celery -A config worker --loglevel=info

   # Запуск beat
   celery -A config beat --loglevel=info
   ```
   
### Кастомная команда
```bash
   python manage.py start_bot
```
Запускает телеграм бота в который можно вписать email пользователя и к нему привяжется telegram chat_id

### Docker

Для запуска проекта в контейнере Docker рекомендуется использовать docker-compose.yml:
```bash
   docker-compose up -d --build
```
Соберёт и запустит контейнеры с Django, PostgreSQL, Redis и Celery локально.
### Развертывание приложения
Для того что бы запустить проект на сервере вам нужно 
- Подключиться к вашей виртуальной машине(серверу)
- Установить Docker и Docker Compose
- Склонировать репозиторий
- Перейти в директории проекта
- Создать .env файл по примеру .env_example и заполнить его вашими данными
```bash
  nano .env 
```
- Запустить Docker Compose
### GitHub Action
В проекте настроен GitHub Action с помощью которого автоматически запускаются линтеры, тесты и развертывание приложения на сервере
для action вам потребуется добавть секреты в ваш репозиторий в настройках репозитория:
- DEBUG - для логирования дебага
- POSTGRES_DB - имя базы данных
- POSTGRES_PASSWORD - пароль для базы данных
- POSTGRES_USER - имя пользователя для базы данных
- SECRET_KEY - секретный ключ Django
- SERVER_IP - IP сервера
- SSH_KEY - SSH ключ для подключения к серверу
- SSH_USER - имя пользователя SSH
- TELEGRAM_BOT_TOKEN - токен бота Telegram

## IP сервера

Приложение доступно по адресу: [158.160.140.185](http://158.160.140.185)